{% extends 'base_content.html' %}
{% load static %}

{% block head %}

<!-- CSS only -->
{% comment %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
{% endcomment %}

<link rel="stylesheet" href="{% static 'css/playing.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- JavaScript Bundle with Popper -->
<script src="/static/js/lyric.js"></script>
<script>

  $(document).ready(function(){
    if(window.location.pathname == '/playing'){
      let complete = document.getElementById('complete');
      let nextlevel = document.getElementById('nextlevel');
      let mymargin = document.getElementById('mymargin');
      mymargin.style.height = '270px';
      complete.style.display = 'none';
      nextlevel.style.display = 'none';
    }
  });
  
  function makeLyric() {
    let url = document.forms[0].elements['lyric'].value;
    //window.location.replace('http://127.0.0.1:8000/playing/' + url)
    // ec2 ë°°í¬ url
    window.location.replace( window.location.href + '/playing/' + url);
    document.getElementById('firstline').value = "";

    //ë²„íŠ¼ì´ ëˆŒë¦¬ê³  ë‚˜ì„œ ì‘ì‚¬ ì§„í–‰ ì¤‘ questionì´ ëœ¸
    //ì‹œê°„ì´ íë¦„
    //quesiontê³¼ answerì´ ë°”ë€œ

    let loading = document.getElementById('loading');
    loading.style.display = 'block';

    let complete = document.getElementById('complete');
    complete.style.display = 'none';
    
    return false;
  }

  function makeSave(){
    let loading = document.getElementById('loading');
    loading.style.display = 'none';

    let complete = document.getElementById('complete');
    complete.style.display = 'block';

    let nextlevel = document.getElementById('nextlevel');
    nextlevel.style.display = 'block';
  }

  let recommends = [];

  window.addEventListener('DOMContentLoaded', function () {
    word = localStorage.getItem('myword');
    document.getElementById('firstline').value = word;
    recommends = findPrompts(word);
    let buttons = Array.from(document.getElementsByClassName("btn btn-warning"));
    for (let i = 0; i < 5; i++) {
      if (recommends[i] == undefined){//íƒœì˜: undefinedì¼ë•Œ undefinedê°€ ëœ¨ì§€ ì•Šë„ë¡ ì„¤ì •
        buttons[i].style="display:none;"
      }
      buttons[i].innerHTML = recommends[i];
    }
    });

  
  function setFirstLine(event) {
    recommends.splice(0);
    word = event.target.value
    recommends = findPrompts(word);
    let buttons = Array.from(document.getElementsByClassName("btn btn-warning"));
    for (let i = 0; i < 5; i++) {
      if (recommends[i] == undefined){//íƒœì˜: undefinedì¼ë•Œ undefinedê°€ ëœ¨ì§€ ì•Šë„ë¡ ì„¤ì •
        buttons[i].style="display:none;"
      }
      buttons[i].innerHTML = recommends[i];
    }
  }

  function setLyric(event) {
    input = document.getElementById("firstline");
    input.value = event.target.innerHTML;
  }

  {% comment %} function dontReload(event){
    console.log("ì•¼");
    event.preventDefault();
    return true;
  } {% endcomment %}


</script>

{% endblock head %}

{% block content %}

<div class="playing">
  <h1>ğŸ¨ê·¸ë¦¼ì„ ë°”íƒ•ìœ¼ë¡œ ìì‹ ë§Œì˜ ë™ìš”ğŸ¶ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h1><br>
  <div class="playing-content">
    <form  class="my-form" method="POST" action="{% url 'main_page:post' %}">
      {% csrf_token %}

      <div class="hidden">
        <div class="question">
          <img src="{% static 'img/smile.png' %}" />
          <div style="display:flex;flex-direction:column;">
            <p style="margin-bottom:10px">"ì„ íƒí•œ í‚¤ì›Œë“œì— ë§ì¶° ë™ìš”ì˜ ì²« ì†Œì ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤."</p>
            <p>"ì„ íƒí•´ì£¼ì„¸ìš”."</p>
          </div>
        </div>

        <div class="answer">
          <div style="display:flex">
            <input type="text" placeholder="ë‹¨ì–´ë¥¼ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." id="firstline" name="lyric" size="40"
            onkeyup="setFirstLine(event)">
            <p id="reload" onclick="window.location.reload()"><i class="fa fa-refresh" aria-hidden="true"></i></p>
          </div>
          <div class="container">
            <button type="button" onclick="return setLyric(event);" class="btn btn-warning" id="line1"></button>
            <button type="button" onclick="return setLyric(event);" class="btn btn-warning" id="line2"></button>
            <button type="button" onclick="return setLyric(event);" class="btn btn-warning" id="line3"></button>
            <button type="button" onclick="return setLyric(event);" class="btn btn-warning" id="line4"></button>
            <button type="button" onclick="return setLyric(event);" class="btn btn-warning" id="line5"></button>
          </div>
          
        </div> 
      </div>

      <div class="hidden">
        <div class="question">
          <img src="{% static 'img/smile.png' %}" />
          <div>
            <p>"ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì‘ì‚¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤."</p>
          </div>
        </div>
        <div class="answer">
          <button type="button" onclick="return makeLyric();" class="btn btn-primary makelyricButton">ì‘ì‚¬ì‹œì‘!</button><br>
        </div>
      </div>
      
      <div class="hidden" id="loading" style="display:none">
        <div class="question">
          <img src="{% static 'img/smile.png' %}" />
          <div>
            <p id="waitLyricTitle">"ì‘ì‚¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤"</p>
          </div>
        </div>
        <div class="answer">
          <i class="fa fa-spinner fa-spin"></i>
        </div>
      </div>

      <div class="hidden" id="complete" style="display:block">
        <div class="question">
          <img src="{% static 'img/smile.png' %}" />
          <div>
            <p id="waitLyricTitle">"ì‘ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"</p>
          </div>
        </div>
        <div class="answer">
          <i style="display:none" class="fa fa-spinner fa-spin"></i>
          <textarea rows="10" cols="70" class="lyricResult" placeholder="ì‘ì‚¬ ë‚´ìš©ì´ ì¶œë ¥ë©ë‹ˆë‹¤." 
          name="content" id="content">{{lyric}}</textarea><br>
          <button type="submit" class="btn btn-secondary makelyricButton">ì €ì¥í•˜ê¸°</button>
        </div>
      </div>

      <div class="hidden" id="nextlevel" style="display:block">
        <div class="question">
          <img src="{% static 'img/smile.png' %}" />
          <div>
            <p id="waitLyricTitle">"ì‘ê³¡ì„ ì‹œì‘í• ê¹Œìš”?"</p>
          </div>
        </div>
        <div class="answer">
          <i style="display:none" class="fa fa-spinner fa-spin"></i>
          <button type="button" class="btn btn-secondary returnButton" onclick="location.href='/drawing'">ë‹¤ì‹œ ê·¸ë¦¼ ê·¸ë¦¬ê¸°</button>
          <button type="button" class="btn btn-secondary makelyricButton" onclick="location.href='/composing'">ì‘ê³¡ ì‹œì‘í•˜ê¸°</button>
        </div>
      </div>
    </form>
  </div>

  <div id="mymargin" style="display:hidden; height:50px"></div>
</div>

<script>
  var na = document.getElementById('na');
  na.addEventListener('submit', handleSubmit);

  let content = document.getElementById('content');
  let whiteSpace = content.value;

  let TempSpace = whiteSpace.replaceAll(/(?:\\r\\n|\\r|\\n|\\)/g , "&#10;");
  TempSpace = TempSpace.replaceAll('<unk>', "&nbsp;");

  content.innerHTML =  TempSpace;

  //console.log(content.value);
  //console.log(whiteSpace.replaceAll(/(?:\\r\\n|\\r|\\n|\\)/g , "&#10;"));
</script>
{% endblock content %}