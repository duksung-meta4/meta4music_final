{% extends 'base_content.html' %}
{% load static %}

{% block head %}


<!-- CSS only -->
  {% comment %} <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  
    <!-- JavaScript Bundle with Popper --> {% endcomment %}
  <!--<link rel="stylesheet" href="{% static 'css/playing.css' %}">
  <script src="/static/js/composing.js"></script>-->

  <link rel="stylesheet" href="{% static 'css/composing.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>

    $(document).ready(function(){
      //console.log(window.location.pathname);
      if(window.location.pathname == '/composing/'){
        let complete = document.getElementById('complete');
        let nextlevel = document.getElementById('nextlevel');
        let mymargin = document.getElementById('mymargin');
        complete.style.display = 'none';
        nextlevel.style.display = 'none';
        mymargin.style.height = '450px';
      }

      if(window.location.pathname.includes(`/composing/`)){
        $("#start").css("background-color", "#80D4D6"); //ì‘ê³¡ì‹œì‘
        $("#result").css("background-color", "#F69165"); //ì‘ê³¡ ê²°ê³¼ë³´ê¸°
        $("#mypage").css("background-color", "#80D4D6"); //ê²°ê³¼ë³´ê¸°
  
        $("#start").hover(function(){
          $(this).css("background-color", "#6DB2B4");
        }, function(){
          $(this).css("background-color", "#80D4D6");
        })
  
        $("#result").hover(function(){
          $(this).css("background-color", "#E26D3A");
        }, function(){
          $(this).css("background-color", "#F69165");
        })

        $("#mypage").hover(function(){
          $(this).css("background-color", "#6DB2B4");
        }, function(){
          $(this).css("background-color", "#80D4D6");
        })
      }

      if(window.location.pathname == '/post2'){
        let savebutton = document.getElementById("savebutton");
        savebutton.disabled = true;

        let mypage = document.getElementById("mypage");
        mypage.disabled = false;

        $("#start").css("background-color", "#80D4D6"); //ì‘ê³¡ì‹œì‘
        $("#result").css("background-color", "#F69165"); //ì‘ê³¡ ê²°ê³¼ë³´ê¸°
        $("#mypage").css("background-color", "#80D4D6"); //ê²°ê³¼ë³´ê¸°
  
        $("#start").hover(function(){
          $(this).css("background-color", "#6DB2B4");
        }, function(){
          $(this).css("background-color", "#80D4D6");
        })
  
        $("#result").hover(function(){
          $(this).css("background-color", "#E26D3A");
        }, function(){
          $(this).css("background-color", "#F69165");
        })

        $("#mypage").hover(function(){
          $(this).css("background-color", "#6DB2B4");
        }, function(){
          $(this).css("background-color", "#80D4D6");
        })
        

        $("#result").click(function(){
          $("#savebutton").css("background-color", "#80D4D6");
          $("#mypage").css("background-color", "#F69165");

          $("#savebutton").hover(function(){
            $(this).css("background-color", "#6DB2B4");
          }, function(){
            $(this).css("background-color", "#80D4D6");
          })

          $("#mypage").hover(function(){
            $(this).css("background-color", "#E26D3A");
          }, function(){
            $(this).css("background-color", "#F69165");
          })
        })

        
      }
    });

    function makeSong(){

      let loading = document.getElementById('loading');
      loading.style.display = 'block';

      let complete = document.getElementById('complete');
      complete.style.display = 'none';

      let mymargin = document.getElementById('mymargin');
      mymargin.style.height = '400px';
      // ê·¸ë¦¼ì—ì„œ ì„ íƒí•œ ë‹¨ì–´ì— ëŒ€í•œ 7ê°€ì§€ í‚¤ì›Œë“œ ë¶„ë¥˜ê°’ ê°€ì ¸ì˜´
      const keyword_fillter2 = {
        "ì‚°" : "nature",
        "ë°”ëŒ" : "nature",
        "ë‘¥ê·¼ í•´" : "nature",
        "í˜¸ìˆ˜" : "nature",
        "ë°”ë‹¤" : "nature",
        "í•˜ëŠ˜" : "nature",
        "êµ¬ë¦„" : "nature",
        "ë³„" : "nature",
        "ë‹¬" : "nature",
        "ê¸¸" : "nature",
        "ì‹œëƒ‡ë¬¼" : "nature",
        "ëˆˆ" : "nature",
        "ë¹›" : "nature",
        "ë¹—ë°©ìš¸" : "nature",
        "ë¬¼" : "nature",
        "ìƒˆ" : "animal",
        "ë‹¤ëŒì¥" : "animal",
        "ì›ìˆ­ì´" : "animal",
        "ë‚˜ë¹„" : "animal",
        "ì ìë¦¬" : "animal",
        "ê°•ì•„ì§€" : "animal",
        "ê°œêµ¬ë¦¬" : "animal",
        "ë¬¼ê³ ê¸°" : "animal",
        "ê³°" : "animal",
        "ë£¨ëŒí”„" : "animal",
        "ë¶€ì—‰" : "animal",
        "í† ë¼" : "animal",
        "ì†¡ì•„ì§€" : "animal",
        "ë¼ì§€" : "animal",
        "ì—¬ìš°" : "animal",
        "ê³ ê¸°" : "animal",
        "ì½”ë¼ë¦¬" : "animal",
        "ê¸°ë¦°" : "animal",
        "ë²Œë ˆ" : "animal",
        "ë‚˜ê·€" : "animal",
        "ê³ ì–‘ì´" : "animal",
        "ìœ™ìœ™" : "animal",
        "ì§‘" : "family",
        "ì°½ê°€" : "family",
        "ì–¼êµ´" : "family",
        "ì—„ë§ˆ" : "family",
        "ì•„ë¹ " : "family",
        "ì˜¤ë¹ " : "family",
        "í• ì•„ë²„ì§€" : "family",
        "ì•„ì €ì”¨" : "family",
        "ì•„ê¸°" : "family",
        "ë°¥" : "family",
        "ì†" : "family",
        "ëˆˆ" : "family",
        "ë°œ" : "family",
        "ì½”" : "family",
        "íŒ”" : "family",
        "ë¬´ë¦" : "family",
        "ëª¸" : "family",
        "ê³ í–¥" : "family",
        "ì§‘" : "family",
        "ìœ—ë‹ˆ" : "family",
        "ë…¸ë˜" : "friendship",
        "í•™êµ" : "friendship",
        "ì¹œêµ¬" : "friendship",
        "ë™ë„¤" : "friendship",
        "ìƒì¼" : "friendship",
        "ì†œì‚¬íƒ•" : "friendship",
        "ì‹œì†Œ" : "friendship",
        "ì„ ìƒë‹˜" : "friendship",
        "êµ¬ìŠ¬" : "friendship",
        "ë¶" : "friendship",
        "ì›ƒìŒ" : "love",
        "ì•„ì´ìŠ¤í¬ë¦¼" : "love",
        "ì‚¬ë‘" : "love",
        "ëˆˆì‚¬ëŒ" : "love",
        "í…”ë ˆë¹„ì „" : "love",
        "ë¬´ì§€ê°œ" : "love",
        "ê½ƒ" : "plant",
        "ë‚˜ë¬´" : "plant",
        "í† ë§ˆí† " : "plant",
        "ì½©" : "plant",
        "ë„ë¼ì§€" : "plant",
        "ì•ëœ°" : "plant",
        "ë³´ë¦¬" : "plant",
        "ì‚¬ê³¼" : "plant",
        "ì”¨ì•—" : "plant",
        "í’€" : "plant",
        "ê³¡ì‹" : "plant",
        "ì" : "plant",
        "ì—°" : "etc",
        "ëª¨ì" : "etc",
        "ë§ˆë²•" : "etc",
        "ê¸°ì°¨" : "etc",
        "ìë™ì°¨" : "etc",
        "ë¹„í–‰ê¸°" : "etc",
        "ë„ê¹¨ë¹„" : "etc",
        "ë¹¤ìŠ¤" : "etc",
        "ìª½ë°°" : "etc",
        "ìƒˆì‹ " : "etc",
        "ì‹œê³„" : "etc",
        "ë‘˜ë¦¬" : "etc",
        "ì¸ë””ì–¸" : "etc",
        "íƒœê·¹ê¸°" : "etc",
        "ë°”êµ¬ë‹ˆ" : "etc",
        "ê³¼ì" : "etc",
        "ìŸë°˜" : "etc",
        "ë“±ëŒ€" : "etc",
        "ë¦¬ë³¸" : "etc",

      }


      word = localStorage.getItem('myword');

      keyword =  keyword_fillter2[word];

      //window.location.replace('http://127.0.0.1:8000/composing/' + keyword)
      // ec2 ë°°í¬ url
      window.location.replace(keyword);

      return false;
    }


    {% comment %} window.onload = function (event) {
      word = localStorage.getItem('myword');
      document.getElementById('chosen_keyword').innerText = word;
    } {% endcomment %}

    window.addEventListener('DOMContentLoaded', function(){
      word = localStorage.getItem('myword');
      document.getElementById('chosen_keyword').innerText = word;
    });

    function lookResult(){
      //const start = document.getElementById('start');
      //start.style.display = 'none';

      let mymargin = document.getElementById('mymargin');
      mymargin.style.height = '50px';

      const control = document.getElementById('midi-control');
      control.style.display = 'block';

      $("#result").css("background-color", "#80D4D6");
      $("#savebutton").css("background-color", "#F69165");

      $("#result").hover(function(){
        $(this).css("background-color", "#6DB2B4");
      }, function(){
        $(this).css("background-color", "#80D4D6");
      })

      $("#savebutton").hover(function(){
        $(this).css("background-color", "#E26D3A");
      }, function(){
        $(this).css("background-color", "#F69165");
      })

      return false;
    }

  </script>

{% endblock head %}

{% block content %}
<div class="composing">
  <h1>ğŸ¨ê·¸ë¦¼ì„ ë°”íƒ•ìœ¼ë¡œ ìì‹ ë§Œì˜ ë™ìš”ğŸ¶ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h1><br>
  <div class="composing-content">
  <form class="my-form" method="POST" action="{% url 'main_page:post2' %}">
    {% csrf_token %}

    <div class="hidden">
      <div class="question">
        <img src="{% static 'img/smile.png' %}" />
        <div>
          <p id="waitLyricTitle">"í˜„ì¬ ì„ íƒë˜ì–´ ìˆëŠ” í‚¤ì›Œë“œëŠ” <span id="chosen_keyword" style="color:#80D4D6;font-weight:bold;"></span> ì…ë‹ˆë‹¤"</p>
        </div>
      </div>
      <div class="answer">
        <button type="button" onclick="return makeSong();" class="btn btn-primary makelyricButton" id="start">ì‘ê³¡ì‹œì‘</button><br>
      </div>
    </div>

    <div class="hidden" id="loading" style="display:none">
      <div class="question">
        <img src="{% static 'img/smile.png' %}" />
        <div>
          <p id="waitLyricTitle">"ì‘ê³¡ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤."</p>
        </div>
      </div>
      <div class="answer">
        <i class="fa fa-spinner fa-spin"></i>
      </div>
    </div>

    <div class="hidden" id="complete" style="display:block">
      <div class="question">
        <img src="{% static 'img/smile.png' %}" />
        <div>
          <p id="waitLyricTitle">"ì‘ê³¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"</p>
        </div>
      </div>
      <div class="answer">
        <i style="display:none" class="fa fa-spinner fa-spin"></i>
        <button type="button" onclick="return lookResult();" class="btn btn-primary makelyricButton" id="result">ì‘ê³¡ ê²°ê³¼ ë³´ê¸°</button><br>
        <textarea class="form-control" placeholder="ì‘ê³¡ ë£¨íŠ¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤." id="floatingTextarea2" name="content" id="content" style="display:none">{{midi}}</textarea><br>
        <!-- ì•…ë³´ ì¶œë ¥ -->
        <div class="controls" id="midi-control" style="display: none;">
          <section id="section1">
            <h2>1 player, 2 visualizers</h2>
            <midi-visualizer
              type="piano-roll"
              src="{% static midi %}">
            </midi-visualizer>
            <midi-visualizer
              type="staff"
              src="{% static midi %}">
            </midi-visualizer>
            <midi-player
              src="{% static midi %}"
              sound-font visualizer="#section1 midi-visualizer">
            </midi-player>
          </section>
          <!-- ì €ì¥ ë²„íŠ¼ -->
          <button type="submit" id="savebutton" style="margin-top:15px" class="btn btn-secondary makelyricButton">ì €ì¥í•˜ê¸°</button>
        </div>
      </div>
    </div>

    <div class="hidden" id="nextlevel" style="display:block">
      <div class="question">
        <img src="{% static 'img/smile.png' %}" />
        <div>
          <p id="waitLyricTitle">"ì™„ì„±ëœ ì‘í’ˆì„ ê°ìƒí•´ë³´ì„¸ìš”!"</p>
        </div>
      </div>
      <div class="answer">
        <i style="display:none" class="fa fa-spinner fa-spin"></i>
        <button type="button" id="mypage" disabled="disabled" class="btn btn-secondary makelyricButton" onclick="location.href='/result'">ê²°ê³¼ë³´ê¸°</button>  
      </div>
    </div>

    {% comment %} <div class="mb-3">
      <button type="button" onclick="return makeSong();" class="btn btn-primary" id="start">ì‘ê³¡ì‹œì‘</button><br>
      <button type="button" onclick="return lookResult();" class="btn btn-primary" id="result">ì‘ê³¡ ê²°ê³¼ ë³´ê¸°</button><br>
      <textarea class="form-control" placeholder="ì‘ê³¡ ë£¨íŠ¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤." id="floatingTextarea2" name="content" id="content" style="display:none">{{midi}}</textarea><br>
      <button type="submit" class="btn btn-secondary">ì €ì¥í•˜ê¸°</button>
      <button type="button" class="btn btn-secondary" onclick="location.href='/result'">ê²°ê³¼ë³´ê¸°</button>
    </div> {% endcomment %}
  </form>

  
  <!--<h1>{{ midi }}</h1>-->

  {% comment %} <div class="col-sm-12">
    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div class="alert alert-info">
        {{ message.message }}
        {{ message.tags }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% block content %}
    {% endblock content %}

    <hr /> {% endcomment %}
  </div>

  <div id="mymargin" style="display:hidden; height:200px"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>

  <script>

  </script>
</div>
{% endblock content %}